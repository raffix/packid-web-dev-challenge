<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Monitor Sensor</title>
        <style>
            body {
                font-family: 'Poppins', sans-serif;
                color: #333;
                font-size: 14px;
                background: #f9f9ff;
            }

            h1, h2, h3, h4, h5, h6 {
                margin: 0.5em 0px;
            }

            .card {
                display: inline-block;
                width: 90%;
                margin: 1em 5%;
                padding: 0;
                
                background: #FFF;
                box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
                transition: all 0.3s cubic-bezier(.25,.8,.25,1);
            }

            .card-title,
            .card-body {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;

                width: 90%;
                padding: 1em 5%;
                border-bottom: 1px solid #eaeaef;
            }

            #copyright {
                display: inline-block;
                width: 80%;
                padding: 0px 10%;
                text-align: center;
            }

        </style>
    </head>
    <body>
        <header>
            <div class="card">
                <div class="card-title">
                    <h4 id="sensor-name"></h4>
                </div>
                <div class="card-body">
                    <span id="temperature"></span>
                    <span id="temperature-average"></span>
                    <span id="temperature-recent"></span>
                    <span id="temperature-rate"></span>
                </div>
            </div>
        </header>
        <section>
            <div class="card">
                <div class="card-body">
                    <div id="temperature-filters">
                        <label>Data Inicial</label>
                        <input type="date" id="date-begin" name="date-begin">
                        <label>Data Final</label>
                        <input type="date" id="date-end" name="date-end">
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div id="temperature-chart"></div>
                </div>
            </div>
        </section>
        <footer id="copyright">
            <span>Copyright - PackID 2018</span>
        </footer>
        <script type="text/javascript" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
        <script type="text/javascript">
        var dataSet
            function loadData(data) {
                
                dataSet = JSON.parse(data);

                document.getElementById("sensor-name").innerHTML = dataSet.label;
                document.getElementById("temperature-average").innerHTML = "Faixa de temperatura: " + dataSet.temperature_min + "ºC ~ " + dataSet.temperature_max + "ºC";

                let measurements = dataSet.measurements;
                document.getElementById("temperature-recent").innerHTML = "Atualmente: " + measurements[0].temperature + "ºC";

                let media = 0.00;
                measurements.forEach(element => {
                    
                });
            }

            function requestData () {
                let url = "http://localhost/packid-web-dev-challenge/application/server.php";
                let request = new XMLHttpRequest();
                if (!request) {
                    alert("Erro ao fazer requisição de dados.");
                    return;
                }
                
                request.onreadystatechange = function () {
                    try{
                        if(request.readyState == XMLHttpRequest.DONE && request.status == 200)
                            loadData(request.responseText);
                    }catch (e) {
                        alert("Exceção: " + e.description);
                    }
                }

                request.open("GET", url, true);
                request.send();
            }

            window.onload = function() 
            { 
                requestData();
            }

        </script>
    </body>
</html>